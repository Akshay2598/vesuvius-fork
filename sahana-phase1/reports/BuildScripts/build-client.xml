<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE project [<!ENTITY common-targets SYSTEM "file:./common-targets.xml">]>
<!--
This is a client build script for Virtusa Engineering Dashbord application.
@author Thushera Kawdawatta  @e-mail thushera@virtusa.com
@date   October 26, 2004
-->

<project name="client" default="build-client" basedir=".">

    <!-- Reference to the common targets xml file -->
    &common-targets;

    <!--target name="build-service">
        <ant antfile="build-service.xml" target="build-service" inheritAll="true"/>
    </target-->

    <target name="build-client">
        <tstamp>
            <format property="TODAY" pattern="yyyy.MM.dd 'at' hh:mm:ss z" locale="en"/>
        </tstamp>

        <echo message=""/>
        <echo message="######################################################"/>
        <echo message="#                                                    #"/>
        <echo message="#                     Compiling RMS                  #"/>
        <echo message="#            Date: ${TODAY}        #"/><!--This space is left intentionally-->
        <echo message="#                                                    #"/>
        <echo message="######################################################"/>
        <echo message=""/>

        <!--antcall target="load-env"/-->
        <antcall target="package-client"/>
    </target>

    <!-- Perform the actual compile, turn verbose="on" to see the files being compiled. -->
    <target name="compile-client-framework" description="Compiles the client framework code">
        <echo message=""/>
        <echo message="######################################################"/>
        <echo message="#                                                    #"/>
        <echo message="#       Compiling Client Framework Source files      #"/>
        <echo message="#                                                    #"/>
        <echo message="######################################################"/>
        <echo message=""/>

        <javac destdir="${classes.dir}"
             debug="${build.debug}"
             debuglevel="${build.debuglevel}"
             optimize="${build.optimize}"
             verbose="${build.verbose}"
             includeAntRuntime="on">

             <src path="${src.dir}"/>

	    <exclude name="gov/lk/dms/report/action/**/*.java"/>
	    <exclude name="gov/lk/dms/report/common/**/*.java"/>
	    <exclude name="gov/lk/dms/report/dao/**/*.java"/>
	    <exclude name="gov/lk/dms/report/erms/**/*.java"/>
	    <exclude name="gov/lk/dms/report/to/**/*.java"/>

            <include name="gov/lk/dms/report/framework/**/*.java"/>

            <classpath refid="libs"/>
        </javac>
    </target>

  <target name="check-build-client-framework-jar.needed" depends="compile-client-framework">
    <uptodate property="check-build-client-framework-jar.not.needed" targetfile="${build.jars.dir}/report-client-framework.jar">
      <srcfiles dir="${src.dir}" includes="**/gov/lk/dms/report/framework/**/*.java"/>
      <srcfiles dir="${classes.dir}" includes="**/gov/lk/dms/report/framework/**/*.class"/>
    </uptodate>
  </target>

  <target name="build-client-framework-jar" description="Creates the framework jar file" depends="check-build-client-framework-jar.needed" unless="check-build-client-framework-jar.not.needed">
        <echo message=""/>
        <echo message="######################################################"/>
        <echo message="#                                                    #"/>
        <echo message="#           Creating the report-framework.jar        #"/>
        <echo message="#                                                    #"/>
        <echo message="######################################################"/>
        <echo message=""/>
        <delete file="${build.jars.dir}/report-framework.jar"/>

        <jar jarfile="${build.jars.dir}/report-framework.jar"
		 basedir="${classes.dir}"
		 includes="**/gov/lk/dms/report/framework/**/*.class"/>
  </target>

    <!-- Perform the actual compile, turn verbose="on" to see the files being compiled. -->
    <target name="compile-client" description="Compiles the client code" depends="build-client-framework-jar">
        <echo message=""/>
        <echo message="######################################################"/>
        <echo message="#                                                    #"/>
        <echo message="#            Compiling Client Source files           #"/>
        <echo message="#                                                    #"/>
        <echo message="######################################################"/>
        <echo message=""/>

        <javac destdir="${classes.dir}"
             debug="${build.debug}"
             debuglevel="${build.debuglevel}"
             optimize="${build.optimize}"
             verbose="${build.verbose}"
             includeAntRuntime="on">

             <src path="${src.dir}"/>

             <exclude name="gov/lk/dms/report/framework/**/*.java"/>
             <include name="gov/lk/dms/report/**/*.java"/>

             <classpath refid="libs"/>
        </javac>
    </target>

  <target name="check-build-client-jar.needed" depends="compile-client">
    <uptodate property="check-build-client-jar.not.needed" targetfile="${build.jars.dir}/ved-client.jar">
        <srcfiles dir="${classes.dir}" includes="**/gov/lk/dms/report/**/*.class" excludes="**/gov/lk/dms/report/framework/**/*.class"/>
    </uptodate>
  </target>
  
    <target name="build-client-jar" description="Creates the framework jar file" depends="check-build-client-jar.needed" unless="check-build-client-jar.not.needed">
	    <echo message=""/>
	    <echo message="######################################################"/>
	    <echo message="#                                                    #"/>
	    <echo message="#           Creating the report-client.jar           #"/>
	    <echo message="#                                                    #"/>
	    <echo message="######################################################"/>
	    <echo message=""/>
	    <delete file="${build.jars.dir}/report-client.jar"/>

	    <jar jarfile="${build.jars.dir}/report-client.jar"
		 basedir="${classes.dir}"
		 excludes="**/gov/lk/dms/report/framework/**/*.class"
		 includes="**/gov/lk/dms/report/**/*.class"/>
    </target>

  <target name="check-build-war.needed" depends="build-client-jar">
    <uptodate property="check-build-war.not.needed" targetfile="${deploy.dir}/reports.war">
      <srcfiles dir="${src.dir}/web" includes="**/*.*"/>
      <srcfiles dir="${build.jars.dir}" includes="**/*.jar"/>
    </uptodate>
  </target>

  <target name="package-client" depends="check-build-war.needed" unless="check-build-war.not.needed">
        <echo message=""/>
        <echo message="######################################################"/>
        <echo message="#                                                    #"/>
        <echo message="#              Creating the reports.war              #"/>
        <echo message="#                                                    #"/>
        <echo message="######################################################"/>
        <echo message=""/>

        <copy todir="${build.web.dir}">
            <fileset dir="${src.dir}/web" excludes="${src.dir}/web/WEB-INF/lib/servlet*.jar"/>
        </copy>

        <!-- The exclude above doesn't seem to work, so delete explicitly -->
        <delete file="${build.web.dir}/WEB-INF/lib/servlet*.jar"/>

        <!-- copy the *.properties file from ${resources.dir}/Messages to ${build.web.dir}/WEB-INF/classes folder
        <copy todir="${build.web.dir}/WEB-INF/classes">
    	    <fileset dir="${resources.dir}/reports">
            </fileset>
        </copy>
        -->

        <copy todir="${build.web.dir}/WEB-INF/lib">
      	    <fileset dir="${build.jars.dir}" includes="report-client.jar,report-framework.jar"/>
        </copy>
        
        <war destfile="${deploy.dir}/rms-reports.war"
	     webxml="${build.web.dir}/WEB-INF/web.xml">
             <fileset dir="${build.web.dir}"/>
        </war>
  </target> 

</project>
